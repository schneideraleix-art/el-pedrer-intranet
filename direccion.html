<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Directivo + Centralita VoIP - El Pedrer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        :root { --admin-red: #e63946; --sidebar-dark: #1a1a1a; --bg-light: #f8f9fa; --voip-blue: #0ea5e9; }
        body { background-color: var(--bg-light); font-family: 'Segoe UI', sans-serif; display: flex; margin: 0; min-height: 100vh; }

        /* Sidebar */
        .sidebar { width: 260px; background: var(--sidebar-dark); color: white; position: fixed; height: 100vh; padding: 25px; z-index: 1000; }
        .nav-link { color: rgba(255,255,255,0.7); padding: 12px 15px; border-radius: 12px; margin-bottom: 8px; display: flex; align-items: center; text-decoration: none; transition: 0.3s; }
        .nav-link:hover, .nav-link.active { background: var(--admin-red); color: white; }
        
        .main-content { margin-left: 260px; width: calc(100% - 260px); padding: 40px; }

        /* Tarjetas Dashboard */
        .stat-card { background: white; border-radius: 15px; padding: 20px; border-left: 5px solid var(--admin-red); box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        
        /* Botones Apps */
        .app-btn { background: white; border-radius: 20px; padding: 30px; text-align: center; border: none; transition: 0.3s; height: 100%; width: 100%; box-shadow: 0 5px 15px rgba(0,0,0,0.02); }
        .app-btn:hover { transform: translateY(-5px); box-shadow: 0 12px 25px rgba(0,0,0,0.08); }
        .app-icon { font-size: 2.5rem; margin-bottom: 15px; display: block; }

        /* CENTRALITA VOIP MODAL */
        #centralitaModal { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); z-index: 9999; 
        }
        .voip-box { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 800px; background: white; border-radius: 30px; display: flex; height: 550px; overflow: hidden;
        }
        .voip-sidebar { width: 35%; background: #f1f5f9; padding: 30px; border-right: 1px solid #e2e8f0; }
        .voip-main { width: 65%; padding: 40px; text-align: center; position: relative; }

        /* Animación de Llamada Entrante */
        .incoming-call { animation: shake 0.5s infinite; color: #22c55e; font-size: 4rem; }
        @keyframes shake { 0% { transform: rotate(0); } 25% { transform: rotate(10deg); } 50% { transform: rotate(0); } 75% { transform: rotate(-10deg); } 100% { transform: rotate(0); } }
        
        .bot-pulse { width: 80px; height: 80px; background: var(--voip-blue); border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem; position: relative; }
        .bot-pulse::after { content: ""; position: absolute; width: 100%; height: 100%; border: 4px solid var(--voip-blue); border-radius: 50%; animation: pulse-blue 1.5s infinite; }
        @keyframes pulse-blue { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(1.5); opacity: 0; } }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="text-center mb-5">
        <h4 class="fw-bold mb-0">EL PEDRER</h4>
        <small class="opacity-50">SISTEMA DIRECTIVO</small>
    </div>
    <nav>
        <a href="#" class="nav-link active"><i class="bi bi-speedometer2 me-2"></i> Dashboard</a>
        <a href="personal_docente.html" class="nav-link"><i class="bi bi-people me-2"></i> Claustro</a>
        <a href="#" class="nav-link"><i class="bi bi-camera-video me-2"></i> CCTV</a>
        <button class="btn btn-danger w-100 rounded-pill mt-5 fw-bold" onclick="simularLlamadaExterna()">
            <i class="bi bi-phone-vibrate me-2"></i> PROBAR 674020247
        </button>
    </nav>
</div>

<div class="main-content">
    <div class="d-flex justify-content-between align-items-center mb-5">
        <h2 class="fw-bold">Panel de Control Directivo</h2>
        <div class="text-end">
            <span class="badge bg-success rounded-pill p-2 px-3">Centralita Online: 674 02 02 47</span>
        </div>
    </div>

    <div class="row g-4 mb-5">
        <div class="col-md-3"><div class="stat-card"><h6>MATRÍCULA</h6><h2 class="fw-bold">842</h2></div></div>
        <div class="col-md-3"><div class="stat-card" style="border-left-color: #ffb703;"><h6>ABSENTISMO</h6><h2 class="fw-bold">12</h2></div></div>
        <div class="col-md-3"><div class="stat-card" style="border-left-color: #219ebc;"><h6>COMEDOR</h6><h2 class="fw-bold">315</h2></div></div>
        <div class="col-md-3"><div class="stat-card" style="border-left-color: #023047;"><h6>CAJA</h6><h2 class="fw-bold">1.250€</h2></div></div>
    </div>

    <div class="row g-4">
        <div class="col-md-3"><button class="app-btn" onclick="window.location.href='gestion_bajas.html'"><i class="bi bi-person-x app-icon text-danger"></i><b>Control Bajas</b></button></div>
        <div class="col-md-3"><button class="app-btn"><i class="bi bi-calculator app-icon text-primary"></i><b>Contabilidad</b></button></div>
        <div class="col-md-3"><button class="app-btn" onclick="lanzarTimbre()"><i class="bi bi-bell-fill app-icon text-warning"></i><b>Timbre Manual</b></button></div>
        <div class="col-md-3"><button class="app-btn" onclick="abrirCentralita()"><i class="bi bi-headset app-icon text-success"></i><b>Marcador VoIP</b></button></div>
    </div>
</div>

<div id="centralitaModal">
    <div class="voip-box shadow-lg">
        <div class="voip-sidebar">
            <h6 class="fw-bold mb-4">EXTENSIONES RÁPIDAS</h6>
            <div class="list-group list-group-flush">
                <button class="list-group-item list-group-item-action border-0 mb-2 rounded shadow-sm">Secretaría (101)</button>
                <button class="list-group-item list-group-item-action border-0 mb-2 rounded shadow-sm">Conserjería (102)</button>
                <button class="list-group-item list-group-item-action border-0 mb-2 rounded shadow-sm">Sala Profesores (200)</button>
            </div>
        </div>
        <div class="voip-main">
            <button class="btn-close position-absolute top-0 end-0 m-4" onclick="cerrarCentralita()"></button>
            
            <div id="voipStatus">
                <i class="bi bi-telephone-inbound-fill incoming-call mb-4 d-block" id="phoneIcon"></i>
                <h3 class="fw-bold" id="callerID">Esperando llamada...</h3>
                <p class="text-muted" id="callStep">Línea 674 02 02 47 lista</p>
                
                <div id="botSection" style="display:none;">
                    <div class="bot-pulse"><i class="bi bi-robot"></i></div>
                    <p class="fst-italic" id="botText">"Hola, soy el asistente. ¿Con quién desea hablar?"</p>
                </div>

                <div class="d-flex justify-content-center gap-3 mt-4">
                    <button class="btn btn-success btn-lg px-5 rounded-pill fw-bold" id="btnAceptar" onclick="contestarLlamada()">CONTESTAR</button>
                    <button class="btn btn-danger btn-lg px-5 rounded-pill fw-bold" onclick="cerrarCentralita()">COLGAR</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let ringingSound = new Audio('https://www.soundjay.com/phone/sounds/phone-calling-1.mp3');
    let onHoldMusic = new Audio('https://www.soundjay.com/free-music/sounds/dream-raid-1.mp3');

    function abrirCentralita() { document.getElementById('centralitaModal').style.display = 'block'; }
    function cerrarCentralita() { 
        document.getElementById('centralitaModal').style.display = 'none'; 
        ringingSound.pause();
        onHoldMusic.pause();
    }

    function simularLlamadaExterna() {
        abrirCentralita();
        document.getElementById('callerID').innerText = "LLAMADA ENTRANTE: 674 02 02 47";
        document.getElementById('callStep').innerText = "Vía Centralita Web";
        ringingSound.play();
    }

    function contestarLlamada() {
        ringingSound.pause();
        document.getElementById('phoneIcon').style.display = 'none';
        document.getElementById('btnAceptar').style.display = 'none';
        document.getElementById('botSection').style.display = 'block';
        onHoldMusic.play();
        
        setTimeout(() => {
            document.getElementById('botText').innerText = '"Entendido. El usuario solicita hablar con Dirección..."';
        }, 2000);

        setTimeout(() => {
            document.getElementById('botText').innerText = '"Transfiriendo llamada al especialista. Por favor, espere..."';
        }, 4000);
    }

    function lanzarTimbre() {
        let bell = new Audio('https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3');
        bell.play();
        alert("TIMBRE DEL CENTRO ACTIVADO");
    }
</script>

</body>
</html>
