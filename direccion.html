<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema IVR - El Pedrer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        :root { --admin-red: #e63946; --sidebar-dark: #121212; --bot-color: #0ea5e9; }
        body { background-color: #f0f2f5; font-family: 'Segoe UI', sans-serif; display: flex; margin: 0; }

        .sidebar { width: 280px; background: var(--sidebar-dark); color: white; position: fixed; height: 100vh; padding: 30px 20px; }
        .nav-link { color: rgba(255,255,255,0.6); padding: 14px 20px; border-radius: 15px; margin-bottom: 10px; display: flex; align-items: center; text-decoration: none; }
        .nav-link.active { background: var(--admin-red); color: white; }

        .main-content { margin-left: 280px; width: calc(100% - 280px); padding: 50px; }

        /* MODAL DE CENTRALITA */
        #phoneModal { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.85); backdrop-filter: blur(10px); z-index: 2000; 
        }
        .phone-container { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 850px; background: white; border-radius: 40px; display: flex; height: 600px; overflow: hidden;
        }
        
        /* Lista de Extensiones */
        .phone-left { width: 35%; background: #f8f9fa; padding: 25px; border-right: 1px solid #eee; overflow-y: auto; }
        .ext-group-title { font-size: 0.7rem; font-weight: 800; color: #999; text-uppercase; margin: 15px 0 5px; letter-spacing: 1px; }
        .ext-item { padding: 8px 15px; border-radius: 12px; cursor: pointer; border: 1px solid transparent; transition: 0.2s; font-size: 0.85rem; display: flex; justify-content: space-between; margin-bottom: 4px; }
        .ext-item:hover { background: white; border-color: var(--admin-red); color: var(--admin-red); box-shadow: 0 4px 12px rgba(0,0,0,0.05); }

        /* Área de Marcación y Bot */
        .phone-right { width: 65%; padding: 40px; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        
        /* Estilo del Bot */
        #botInterface { display: none; text-align: center; width: 100%; }
        .bot-avatar { width: 100px; height: 100px; background: var(--bot-color); border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; color: white; font-size: 3rem; position: relative; }
        .bot-wave { position: absolute; width: 100%; height: 100%; border: 4px solid var(--bot-color); border-radius: 50%; animation: wave 2s infinite; }
        @keyframes wave { 0% { transform: scale(1); opacity: 0.8; } 100% { transform: scale(1.6); opacity: 0; } }

        .keypad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 20px; }
        .key { width: 60px; height: 60px; border-radius: 50%; border: 1px solid #eee; display: flex; align-items: center; justify-content: center; font-weight: 600; cursor: pointer; transition: 0.2s; }
        .key:hover { background: #f0f0f0; }
        .btn-call { background: #22c55e; color: white; border: none; width: 100%; border-radius: 15px; padding: 15px; font-weight: bold; margin-top: 20px; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="text-center mb-5">
        <h4 class="fw-bold">EL PEDRER</h4>
        <p class="small opacity-50">Panel de Administración</p>
    </div>
    <nav>
        <a href="#" class="nav-link active"><i class="bi bi-grid-fill me-3"></i> Dashboard</a>
        <a href="personal_docente.html" class="nav-link"><i class="bi bi-people me-3"></i> Claustro</a>
        <button class="btn btn-danger w-100 rounded-pill mt-5 fw-bold" onclick="abrirCentralita()">
            <i class="bi bi-telephone-fill me-2"></i> MARCADOR VOIP
        </button>
    </nav>
</div>

<div class="main-content">
    <h1 class="fw-bold mb-4">Control de Comunicaciones</h1>
    <div class="alert alert-info rounded-4 border-0 shadow-sm p-4">
        <h5 class="fw-bold"><i class="bi bi-robot me-2"></i> Asistente de Voz Activo</h5>
        El sistema filtrará automáticamente las llamadas externas antes de transferirlas a las extensiones.
    </div>
</div>

<div id="phoneModal">
    <div class="phone-container shadow-lg">
        <div class="phone-left">
            <h5 class="fw-bold mb-3">Directorio Interno</h5>
            
            <div class="ext-group-title">Dirección y Gestión</div>
            <div class="ext-item" onclick="autoMarcar('Dirección', '100')"><span>Dirección</span> <b>100</b></div>
            <div class="ext-item" onclick="autoMarcar('Jefatura Estudios', '101')"><span>Jefatura</span> <b>101</b></div>
            <div class="ext-item" onclick="autoMarcar('Secretaría', '102')"><span>Secretaría</span> <b>102</b></div>
            <div class="ext-item" onclick="autoMarcar('Administración', '103')"><span>Admin</span> <b>103</b></div>

            <div class="ext-group-title">Servicios</div>
            <div class="ext-item" onclick="autoMarcar('Conserjería', '200')"><span>Conserjería</span> <b>200</b></div>
            <div class="ext-item" onclick="autoMarcar('Comedor / Cocina', '201')"><span>Cocina</span> <b>201</b></div>
            <div class="ext-item" onclick="autoMarcar('Enfermería', '202')"><span>Enfermería</span> <b>202</b></div>
            <div class="ext-item" onclick="autoMarcar('Mantenimiento', '203')"><span>Mantenimiento</span> <b>203</b></div>

            <div class="ext-group-title">Departamentos</div>
            <div class="ext-item" onclick="autoMarcar('Sala Profesores', '300')"><span>Sala Prof.</span> <b>300</b></div>
            <div class="ext-item" onclick="autoMarcar('Orientación', '301')"><span>Orientación</span> <b>301</b></div>
            <div class="ext-item" onclick="autoMarcar('Biblioteca', '302')"><span>Biblioteca</span> <b>302</b></div>
            <div class="ext-item" onclick="autoMarcar('Dpto. TICs', '303')"><span>Informática</span> <b>303</b></div>
        </div>
        
        <div class="phone-right">
            <button class="btn-close position-absolute top-0 end-0 m-4" onclick="cerrarCentralita()"></button>

            <div id="dialerUI">
                <h1 id="displayNum" class="fw-bold mb-4">---</h1>
                <div class="keypad">
                    <div class="key" onclick="press('1')">1</div><div class="key" onclick="press('2')">2</div><div class="key" onclick="press('3')">3</div>
                    <div class="key" onclick="press('4')">4</div><div class="key" onclick="press('5')">5</div><div class="key" onclick="press('6')">6</div>
                    <div class="key" onclick="press('7')">7</div><div class="key" onclick="press('8')">8</div><div class="key" onclick="press('9')">9</div>
                    <div class="key text-muted" onclick="clearNum()"><i class="bi bi-backspace"></i></div>
                    <div class="key" onclick="press('0')">0</div>
                    <div class="key" onclick="press('#')">#</div>
                </div>
                <button class="btn-call" onclick="iniciarLlamada()">INICIAR LLAMADA</button>
            </div>

            <div id="botInterface">
                <div class="bot-avatar">
                    <div class="bot-wave"></div>
                    <i class="bi bi-robot"></i>
                </div>
                <h4 class="fw-bold mb-1">Asistente Virtual</h4>
                <p id="botMessage" class="text-muted italic">"Hola, estoy filtrando su llamada para el dpto. seleccionado..."</p>
                <div class="spinner-grow text-info" role="status"></div>
                <button class="btn btn-outline-danger w-100 mt-5 rounded-pill" onclick="colgar()">CANCELAR</button>
            </div>
        </div>
    </div>
</div>

<script>
    let currentNum = "";

    function abrirCentralita() { document.getElementById('phoneModal').style.display = 'block'; }
    function cerrarCentralita() { document.getElementById('phoneModal').style.display = 'none'; colgar(); }

    function press(n) { 
        currentNum += n; 
        document.getElementById('displayNum').innerText = currentNum; 
    }

    function clearNum() { 
        currentNum = ""; 
        document.getElementById('displayNum').innerText = "---"; 
    }

    function autoMarcar(nombre, ext) {
        currentNum = ext;
        document.getElementById('displayNum').innerText = ext;
        iniciarLlamada();
    }

    function iniciarLlamada() {
        if(currentNum === "") return;
        document.getElementById('dialerUI').style.display = 'none';
        document.getElementById('botInterface').style.display = 'block';
        
        // Simulación de los pasos del Bot
        setTimeout(() => {
            document.getElementById('botMessage').innerText = '"Identificando motivo de la consulta..."';
        }, 2000);

        setTimeout(() => {
            document.getElementById('botMessage').innerText = '"Conectando con el profesional responsable. Espere..."';
            document.getElementById('botMessage').classList.add('text-success');
        }, 4000);

        setTimeout(() => {
            alert("Llamada conectada con éxito.");
        }, 6000);
    }

    function colgar() {
        document.getElementById('dialerUI').style.display = 'block';
        document.getElementById('botInterface').style.display = 'none';
        document.getElementById('botMessage').innerText = '"Hola, estoy filtrando su llamada..."';
        document.getElementById('botMessage').classList.remove('text-success');
        clearNum();
    }
</script>

</body>
</html>
