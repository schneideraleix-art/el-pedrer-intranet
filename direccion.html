<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Maestro Pro v2 - El Pedrer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root {
            --bg-body: #f0f2f5;
            --sidebar-bg: #111827;
            --accent: #ff4757;
            --success: #22c55e;
            --card-shadow: 0 10px 30px rgba(0,0,0,0.05);
        }

        body { background: var(--bg-body); font-family: 'Inter', sans-serif; display: flex; height: 100vh; overflow: hidden; margin: 0; }

        /* SIDEBAR MEJORADA */
        .sidebar { width: 280px; background: var(--sidebar-bg); color: white; padding: 30px 20px; display: flex; flex-direction: column; }
        .nav-link { color: #9ca3af; padding: 12px 15px; border-radius: 12px; display: flex; align-items: center; gap: 12px; text-decoration: none; transition: 0.3s; margin-bottom: 5px; }
        .nav-link.active, .nav-link:hover { background: var(--accent); color: white; }

        /* CONTENIDO */
        .content { flex-grow: 1; padding: 30px 40px; overflow-y: auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }

        /* GRID DE TARJETAS PRINCIPALES */
        .grid-main { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .card-custom { 
            background: white; border-radius: 24px; padding: 25px; text-align: center; border: none;
            box-shadow: var(--card-shadow); transition: 0.3s; cursor: pointer;
        }
        .card-custom:hover { transform: translateY(-5px); box-shadow: 0 15px 35px rgba(0,0,0,0.1); }
        .card-custom i { font-size: 2.2rem; display: block; margin-bottom: 12px; }

        /* SECCIÓN DE DATOS Y TABLAS */
        .info-row { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }
        .data-panel { background: white; border-radius: 24px; padding: 25px; box-shadow: var(--card-shadow); }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 5px; }

        /* VoIP Y MODALES (Igual que antes) */
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 10001; align-items: center; justify-content: center; }
        .pe-phone { display: none; position: fixed; bottom: 30px; right: 30px; width: 300px; height: 600px; background: #000; border-radius: 50px; border: 8px solid #222; z-index: 10000; box-shadow: 0 30px 60px rgba(0,0,0,0.5); overflow: hidden; color: white; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h3 class="fw-bold mb-5 text-center"><i class="bi bi-shield-lock"></i> EL PEDRER</h3>
        <nav>
            <a href="#" class="nav-link active"><i class="bi bi-grid-1x2"></i> Dashboard</a>
            <a href="#" class="nav-link"><i class="bi bi-people"></i> Claustro</a>
            <a href="#" class="nav-link"><i class="bi bi-calendar3"></i> Horarios</a>
            <a href="#" class="nav-link"><i class="bi bi-folder"></i> Reportes</a>
            <a href="#" class="nav-link"><i class="bi bi-chat-left-dots"></i> Mensajería</a>
        </nav>
        <div class="mt-auto bg-dark p-3 rounded-4">
            <div id="reloj" class="text-center fw-bold mb-2 fs-5">09:11:00</div>
            <button class="btn btn-outline-light btn-sm w-100" onclick="activarAudio()">Desbloquear Audio</button>
        </div>
    </div>

    <div class="content">
        <div class="header">
            <h2 class="fw-bold m-0">Gestión Directiva Pro</h2>
            <div class="d-flex gap-3 align-items-center">
                <span class="badge bg-success-subtle text-success p-2 px-3 rounded-pill border border-success">
                    <span class="status-dot bg-success"></span> Red Centro: 940 Mbps
                </span>
                <div class="badge bg-white text-dark shadow-sm p-2 px-3 border rounded-pill">PeerID: elpedrer-direccion</div>
            </div>
        </div>

        <div class="row g-4 mb-4">
            <div class="col-md-3"><div class="card-custom"><h6>ALUMNOS</h6><h3 class="text-danger m-0">842</h3></div></div>
            <div class="col-md-3"><div class="card-custom"><h6>DOCENTES</h6><h3 class="text-primary m-0">137</h3></div></div>
            <div class="col-md-3"><div class="card-custom"><h6>INCIDENCIAS</h6><h3 class="text-warning m-0">4</h3></div></div>
            <div class="col-md-3"><div class="card-custom"><h6>COMEDOR</h6><h3 class="text-success m-0">315</h3></div></div>
        </div>

        <div class="grid-main">
            <div class="card-custom" onclick="sonarTimbre()"><i class="bi bi-bell-fill text-warning"></i><b>Timbre Manual</b><p class="small text-muted mb-0">Sirena general</p></div>
            <div class="card-custom" onclick="toggleOverlay('modalDialer')"><i class="bi bi-telephone-plus-fill text-success"></i><b>Marcador</b><p class="small text-muted mb-0">VoIP Externa</p></div>
            <div class="card-custom" onclick="toggleOverlay('modalCCTV')"><i class="bi bi-camera-video-fill text-dark"></i><b>Cámaras</b><p class="small text-muted mb-0">Tiempo real</p></div>
            <div class="card-custom"><i class="bi bi-box-seam-fill text-info"></i><b>Inventario</b><p class="small text-muted mb-0">Pedidos material</p></div>
        </div>

        <div class="info-row">
            <div class="data-panel">
                <h5 class="fw-bold mb-3"><i class="bi bi-tools"></i> Incidencias Activas</h5>
                <table class="table table-hover align-middle">
                    <thead><tr><th>Ubicación</th><th>Problema</th><th>Estado</th><th>Acción</th></tr></thead>
                    <tbody>
                        <tr><td>Aula 204</td><td>Proyector no enciende</td><td><span class="badge bg-warning text-dark">Pendiente</span></td><td><button class="btn btn-sm btn-light border">Avisar</button></td></tr>
                        <tr><td>Gimnasio</td><td>Gotera techo</td><td><span class="badge bg-info text-white">En camino</span></td><td><button class="btn btn-sm btn-light border">Detalles</button></td></tr>
                        <tr><td>Biblioteca</td><td>WiFi Lento</td><td><span class="badge bg-danger">Urgente</span></td><td><button class="btn btn-sm btn-dark">Arreglar</button></td></tr>
                    </tbody>
                </table>
            </div>
            <div class="data-panel">
                <h5 class="fw-bold mb-3"><i class="bi bi-calendar-check"></i> Agenda Hoy</h5>
                <div class="mb-3 p-2 border-start border-4 border-danger bg-light">
                    <small class="text-muted d-block">10:00 AM</small>
                    <b class="small">Reunión de Departamento</b>
                </div>
                <div class="mb-3 p-2 border-start border-4 border-primary bg-light">
                    <small class="text-muted d-block">12:30 PM</small>
                    <b class="small">Entrevista Familias</b>
                </div>
                <div class="p-2 border-start border-4 border-success bg-light">
                    <small class="text-muted d-block">16:00 PM</small>
                    <b class="small">Claustro Extraordinario</b>
                </div>
            </div>
        </div>
    </div>

    <div id="pePhone" class="pe-phone">
        <div class="p-5 text-center">
            <i class="bi bi-person-circle display-1 text-info"></i>
            <h2 id="callerID" class="mt-4 fw-bold">LLAMADA</h2>
            <p id="callStatus" class="opacity-50">Entrante...</p>
            <div class="d-flex justify-content-around mt-5">
                <button class="btn btn-danger btn-lg rounded-circle p-3" onclick="colgar()"><i class="bi bi-telephone-x"></i></button>
                <button id="btnAccept" class="btn btn-success btn-lg rounded-circle p-3" onclick="aceptar()"><i class="bi bi-telephone"></i></button>
            </div>
        </div>
    </div>

    <script>
        const sndRingtone = new Audio('https://serverside-docs.github.io/sounds/ringtone.mp3');
        const peer = new Peer('elpedrer-direccion');
        let callActiva = null;

        // Reloj en tiempo real
        setInterval(() => {
            const now = new Date();
            document.getElementById('reloj').innerText = now.toLocaleTimeString();
        }, 1000);

        function activarAudio() {
            window.speechSynthesis.speak(new SpeechSynthesisUtterance("Audio activado"));
        }

        function toggleOverlay(id) {
            const el = document.getElementById(id);
            if (el) el.style.display = (el.style.display === 'flex') ? 'none' : 'flex';
        }

        function sonarTimbre() {
            new Audio('https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3').play();
            alert("Sirena general activada.");
        }

        // Lógica PeerJS
        peer.on('call', (call) => {
            callActiva = call;
            document.getElementById('pePhone').style.display = 'block';
            document.getElementById('callerID').innerText = (call.metadata.depto || "ENTRANTE").toUpperCase();
            sndRingtone.play(); sndRingtone.loop = true;
        });

        function aceptar() {
            sndRingtone.pause();
            document.getElementById('btnAccept').style.display = 'none';
            navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
                callActiva.answer(stream);
                callActiva.on('stream', remoteStream => {
                    const audio = document.createElement('audio');
                    audio.srcObject = remoteStream; audio.play();
                });
            });
        }

        function colgar() { if(callActiva) callActiva.close(); location.reload(); }
    </script>
</body>
</html>
