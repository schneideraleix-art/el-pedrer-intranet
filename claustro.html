<style>
    /* Añadimos un pequeño ajuste para que los botones de acción se vean mejor */
    .btn-action {
        width: 32px;
        height: 32px;
        padding: 0;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
        transition: 0.2s;
    }
</style>

<div class="card-table">
    <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
            <tr>
                <th class="ps-4">Docente</th>
                <th>Departamento</th>
                <th>Especialidad</th>
                <th>Estado</th>
                <th class="text-end pe-4">Acciones</th>
            </tr>
        </thead>
        <tbody id="tabla-claustro">
            </tbody>
    </table>
</div>

<div class="modal fade" id="modalChat" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow">
            <div class="modal-header bg-dark text-white">
                <h5 class="modal-title" id="chatNombre">Enviar Mensaje</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label small fw-bold">Mensaje Urgente</label>
                    <textarea class="form-control" rows="3" placeholder="Escribe aquí el mensaje para el docente..."></textarea>
                </div>
                <div class="form-check form-switch mb-3">
                    <input class="form-check-input" type="checkbox" id="notifPush">
                    <label class="form-check-label small" for="notifPush">Enviar como notificación Push al móvil</label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="confirmarEnvio()">Enviar Mensaje</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalEditar" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow">
            <div class="modal-header">
                <h5 class="modal-title fw-bold">Editar Ficha Docente</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="formEditarDocente">
                </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-light" data-bs-dismiss="modal">Descartar</button>
                <button type="button" class="btn btn-dark" onclick="guardarCambios()">Guardar Cambios</button>
            </div>
        </div>
    </div>
</div>

<script>
    // --- LÓGICA DE GENERACIÓN (Actualizada para incluir los eventos de los botones) ---
    const nombres = ["García", "Rodríguez", "López", "Sánchez", "Pérez", "Gómez", "Martín"];
    const nombresPila = ["Maria", "Jose", "Antonio", "Carmen", "David", "Lucía", "Elena"];
    const deptos = ["Primaria", "Secundaria", "Infantil"];
    const esps = ["Matemáticas", "Lengua", "Inglés", "Educación Física", "Música"];

    function generarClaustro() {
        const tbody = document.getElementById('tabla-claustro');
        let html = '';

        for (let i = 0; i < 133; i++) {
            const nom = `${nombres[Math.floor(Math.random() * nombres.length)]}, ${nombresPila[Math.floor(Math.random() * nombresPila.length)]}`;
            const dep = deptos[Math.floor(Math.random() * deptos.length)];
            const esp = esps[Math.floor(Math.random() * esps.length)];
            
            html += `
                <tr>
                    <td class="ps-4"><strong>${nom}</strong></td>
                    <td>${dep}</td>
                    <td>${esp}</td>
                    <td><span class="badge bg-success status-pill">En el centro</span></td>
                    <td class="text-end pe-4">
                        <button class="btn btn-action btn-outline-secondary me-1" onclick="abrirChat('${nom}')">
                            <i class="bi bi-chat-dots"></i>
                        </button>
                        <button class="btn btn-action btn-outline-dark" onclick="abrirEditor('${nom}', '${dep}', '${esp}')">
                            <i class="bi bi-pencil"></i>
                        </button>
                    </td>
                </tr>`;
        }
        tbody.innerHTML = html;
    }

    // --- FUNCIONES DE ACCIÓN ---

    function abrirChat(nombre) {
        document.getElementById('chatNombre').innerText = "Chat con " + nombre;
        var myModal = new bootstrap.Modal(document.getElementById('modalChat'));
        myModal.show();
    }

    function abrirEditor(nombre, departamento, especialidad) {
        const contenedor = document.getElementById('formEditarDocente');
        contenedor.innerHTML = `
            <div class="mb-3">
                <label class="form-label small fw-bold">Nombre Completo</label>
                <input type="text" class="form-control" value="${nombre}">
            </div>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label small fw-bold">Departamento</label>
                    <select class="form-select">
                        <option ${departamento === 'Primaria' ? 'selected' : ''}>Primaria</option>
                        <option ${departamento === 'Secundaria' ? 'selected' : ''}>Secundaria</option>
                        <option ${departamento === 'Infantil' ? 'selected' : ''}>Infantil</option>
                    </select>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label small fw-bold">Estado</label>
                    <select class="form-select">
                        <option selected>En el centro</option>
                        <option>Baja Médica</option>
                        <option>En formación</option>
                    </select>
                </div>
            </div>
        `;
        var myModal = new bootstrap.Modal(document.getElementById('modalEditar'));
        myModal.show();
    }

    function confirmarEnvio() {
        alert("✉️ Mensaje enviado con éxito al dispositivo del docente.");
        bootstrap.Modal.getInstance(document.getElementById('modalChat')).hide();
    }

    function guardarCambios() {
        alert("✅ Los datos del docente han sido actualizados en la base de datos.");
        bootstrap.Modal.getInstance(document.getElementById('modalEditar')).hide();
    }

    window.onload = generarClaustro;
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
